# 第14章 例外処理 解答例

この章では、Javaの例外処理の高度な技術を学習します。

## 実装内容

### 1. CustomException.java - カスタム例外クラス
- アプリケーション固有の例外を定義
- エラーコードと詳細情報を管理
- 例外の重要度とタイプ判定機能

**重要ポイント：**
- エラーコードによる例外の分類
- 複数のコンストラクタでの柔軟な例外作成
- 例外チェーンの活用

### 2. ResourceManager.java - try-with-resources活用
- 自動リソース管理の実装
- AutoCloseableインターフェースの活用
- 複雑なリソース管理シナリオ

**重要ポイント：**
- try-with-resourcesによる確実なリソース解放
- 例外発生時の抑制された例外（Suppressed Exception）
- ネストしたリソース管理

### 3. ValidationHelper.java - バリデーション例外
- 入力値検証の包括的な実装
- 複数のバリデーションエラーの集約
- 安全な変換処理

**重要ポイント：**
- 複数のバリデーションエラーの効率的な管理
- 正規表現を使った複雑なバリデーション
- 例外を使わない検証結果の返却

### 4. ExceptionChain.java - 例外チェーン
- **例外チェーンによる根本原因追跡**
- 複雑な例外階層の管理
- 例外の分析と診断機能

**重要ポイント：**
- **例外チェーンの詳細な追跡機能**
- 根本原因の特定と分析
- 再試行可能な例外の判定
- 例外の重要度評価

## 学習のポイント

### 1. 例外処理の基本原則
- 適切な例外の種類選択
- 例外メッセージの有用性
- 例外の階層設計

### 2. try-with-resources
- AutoCloseableインターフェース
- リソースの自動管理
- 例外発生時の動作理解

### 3. 例外チェーンの活用
- 原因例外の保持
- 根本原因の追跡
- 抑制された例外の処理

### 4. カスタム例外設計
- ビジネスロジックに応じた例外設計
- 例外の分類と管理
- 診断情報の提供

## 実行方法

```bash
# コンパイル
javac *.java

# テスト実行（JUnit 5が必要）
java -cp .:junit-platform-console-standalone-1.8.2.jar org.junit.platform.console.ConsoleLauncher --scan-classpath

# 個別実行例
java -cp . CustomExceptionTest
java -cp . ResourceManagerTest
java -cp . ValidationHelperTest
java -cp . ExceptionChainTest
```

## 例外処理のベストプラクティス

### 1. 例外の使い分け
- **チェック例外**: 回復可能なエラー
- **非チェック例外**: プログラムのバグ

### 2. 例外メッセージの設計
- 具体的で理解しやすいメッセージ
- 問題の解決に必要な情報を含める
- 機密情報の漏洩を避ける

### 3. リソース管理
- try-with-resourcesの積極的な活用
- AutoCloseableの適切な実装
- 例外発生時の確実なクリーンアップ

### 4. 例外チェーンの活用
- 原因例外の保持
- 根本原因の追跡可能性
- 抑制された例外の適切な処理

## 実用的な活用例

### 1. Webアプリケーション
- バリデーション例外の統一的な処理
- 例外からHTTPステータスコードの決定
- ユーザーフレンドリーなエラーメッセージ

### 2. バッチ処理
- 処理中断時の状態保存
- 再試行可能な例外の自動処理
- 例外発生時の詳細なログ出力

### 3. データベースアクセス
- 接続エラーの適切な処理
- トランザクション管理
- リトライ機構の実装

## 例外処理の設計原則

1. **早期発見**: 問題を早期に検出
2. **適切な抽象化**: 実装詳細を隠蔽
3. **情報の保持**: 診断に必要な情報を保持
4. **回復可能性**: 可能な限り回復処理を提供
5. **一貫性**: 例外処理の統一されたアプローチ

## 注意点

- 例外処理にはパフォーマンスコストがある
- 過度な例外キャッチは避ける
- 例外の再スローは適切に行う
- finally句よりtry-with-resourcesを優先