# 第15章 基本課題

## 🎯 学習目標
- ファイルI/Oの基本概念（InputStream、OutputStream、Reader、Writer）
- NIO.2（java.nio.file）の活用方法
- テキストファイルとバイナリファイルの読み書き
- ディレクトリ操作とファイル検索
- CSV・JSON等の構造化データ処理
- ファイル監視（WatchService）による動的なファイルシステム管理

## 📝 課題一覧

### 課題1: 基本的なファイル読み書き
**ファイル名**: `BasicFileIO.java`, `BasicFileIOTest.java`

基本的なファイル読み書き操作を実装し、様々なI/O手法を理解してください。

**要求仕様**:
- テキストファイルの読み込み（Files.readAllLines、BufferedReader等）
- テキストファイルの書き込み（Files.write、BufferedWriter等）
- バイナリファイルの読み書き
- 文字エンコーディングの指定
- ファイル存在確認と基本情報取得

**実行例**:
```
=== 基本的なファイル読み書き ===
テキストファイル読み込み:
ファイル: sample.txt
内容:
1: Hello, World!
2: Java File I/O
3: ファイル操作の基本
4: 日本語テキストの処理

ファイル情報:
サイズ: 1,234 バイト
最終更新: 2024-07-04T10:30:00
読み取り可能: true
書き込み可能: true

エンコーディング指定読み込み:
UTF-8: こんにちは、世界！
Shift_JIS: こんにちは、世界！

テキストファイル書き込み:
出力ファイル: output.txt
書き込み完了: 5行
内容確認:
Line 1: Java File I/O Example
Line 2: 現在時刻: 2024-07-04T10:30:00
Line 3: ランダム値: 42
Line 4: ユニコード: 🚀
Line 5: 処理完了

バイナリファイル処理:
画像ファイル読み込み: image.jpg
ファイルサイズ: 256,789 バイト
ヘッダー: FF D8 FF E0 (JPEG形式)
コピー作成: image_copy.jpg
コピー完了: バイト完全一致確認

大きなファイル処理:
ファイル: largefile.txt (10MB)
BufferedReader使用: 145ms
Files.readAllLines使用: 89ms
推奨: Files.readAllLines（小〜中サイズファイル）
```

**評価ポイント**:
- 複数のI/O手法の理解と使い分け
- エンコーディングの適切な処理
- パフォーマンスを考慮したファイル操作



### 課題2: ディレクトリ操作とファイル検索
**ファイル名**: `DirectoryOperations.java`, `DirectoryOperationsTest.java`

ディレクトリの操作とファイル検索機能を実装してください。

**要求仕様**:
- ディレクトリの作成・削除・移動
- ファイル一覧の取得（フィルタリング付き）
- 再帰的なディレクトリ走査
- ファイル検索（名前、サイズ、更新日時等による条件）
- ディレクトリサイズの計算

**実行例**:
```
=== ディレクトリ操作とファイル検索 ===
ディレクトリ作成:
作成: /tmp/java-io-test/
作成: /tmp/java-io-test/subdir1/
作成: /tmp/java-io-test/subdir2/
作成完了

ファイル作成:
/tmp/java-io-test/file1.txt (100KB)
/tmp/java-io-test/file2.log (50KB)
/tmp/java-io-test/subdir1/data.csv (200KB)
/tmp/java-io-test/subdir2/config.properties (5KB)

ディレクトリ一覧:
/tmp/java-io-test/
├── file1.txt (100KB)
├── file2.log (50KB)
├── subdir1/
│   └── data.csv (200KB)
└── subdir2/
    └── config.properties (5KB)

ファイル検索:
.txt ファイル: [file1.txt]
100KB以上: [file1.txt, data.csv]
今日更新: [file1.txt, file2.log, data.csv, config.properties]
拡張子別統計:
.txt: 1ファイル (100KB)
.log: 1ファイル (50KB)
.csv: 1ファイル (200KB)
.properties: 1ファイル (5KB)

再帰的検索:
全ファイル数: 4
総サイズ: 355KB
最大ファイル: data.csv (200KB)
最小ファイル: config.properties (5KB)

ディレクトリ操作:
移動: /tmp/java-io-test/subdir1/ → /tmp/java-io-test/renamed/
コピー: /tmp/java-io-test/file1.txt → /tmp/java-io-test/backup/file1_backup.txt
削除: /tmp/java-io-test/file2.log
削除完了
```

**評価ポイント**:
- NIO.2 の Files クラス活用
- 効率的なディレクトリ走査
- 条件指定による柔軟な検索



### 課題3: CSVデータ処理システム
**ファイル名**: `CsvProcessor.java`, `Employee.java`, `CsvProcessorTest.java`

CSVファイルの読み書きと集計処理を実装してください。

**要求仕様**:
- CSVファイルの読み込み（ヘッダー処理含む）
- オブジェクトとCSVレコードの相互変換
- データのフィルタリングと集計
- CSVファイルの書き出し
- エラーデータの処理

**実行例**:
```
=== CSVデータ処理システム ===
CSVファイル読み込み:
ファイル: employees.csv
ヘッダー: [ID, 名前, 部署, 年齢, 給与]

従業員データ:
1001, 田中太郎, 営業部, 30, 5000000
1002, 佐藤花子, 開発部, 25, 4500000
1003, 鈴木一郎, 開発部, 35, 6000000
1004, 山田次郎, 総務部, 28, 4200000
1005, 中村美咲, 営業部, 32, 5200000

読み込み完了: 5件

データ集計:
部署別統計:
営業部: 2名（平均給与: 5,100,000円）
開発部: 2名（平均給与: 5,250,000円）  
総務部: 1名（平均給与: 4,200,000円）

年齢層別分析:
20代: 2名（平均給与: 4,350,000円）
30代: 3名（平均給与: 5,400,000円）

データフィルタリング:
開発部のみ:
1002, 佐藤花子, 開発部, 25, 4500000
1003, 鈴木一郎, 開発部, 35, 6000000

給与500万円以上:
1001, 田中太郎, 営業部, 30, 5000000
1003, 鈴木一郎, 開発部, 35, 6000000
1005, 中村美咲, 営業部, 32, 5200000

CSVファイル出力:
出力ファイル: filtered_employees.csv
フィルタ条件: 開発部且つ給与450万円以上
出力件数: 2件

エラーデータ処理:
不正なレコード: "1006,不完全データ,部署なし"
エラー: 給与データが不正です
スキップして処理続行

処理結果:
正常データ: 5件
エラーデータ: 1件
処理成功率: 83.3%
```

**評価ポイント**:
- CSVパーサーの実装
- データ変換とエラーハンドリング
- 集計処理の効率的な実装



### 課題4: ログファイル解析システム
**ファイル名**: `LogAnalyzer.java`, `LogEntry.java`, `LogAnalyzerTest.java`

ログファイルを解析し、統計情報を生成するシステムを実装してください。

**要求仕様**:
- ログファイルの解析（アクセスログ、エラーログ等）
- 正規表現を使ったログパース
- 時間範囲でのフィルタリング
- 統計レポートの生成
- 大容量ファイルの効率的処理

**実行例**:
```
=== ログファイル解析システム ===
ログファイル読み込み:
ファイル: access.log (5.2MB, 50,000行)
形式: Apache Common Log Format

サンプルログエントリ:
192.168.1.100 - - [04/Jul/2024:10:30:15 +0900] "GET /index.html HTTP/1.1" 200 1234
192.168.1.101 - - [04/Jul/2024:10:30:16 +0900] "POST /api/login HTTP/1.1" 200 56
192.168.1.102 - - [04/Jul/2024:10:30:17 +0900] "GET /css/style.css HTTP/1.1" 404 0

解析結果:
総リクエスト数: 50,000
解析成功: 49,856（99.7%）
解析失敗: 144（0.3%）

HTTPステータス別統計:
200 OK: 42,345件（84.7%）
404 Not Found: 4,123件（8.2%）
500 Internal Server Error: 1,234件（2.5%）
403 Forbidden: 987件（2.0%）
その他: 1,167件（2.3%）

アクセス頻度分析:
時間別アクセス数:
10:00-11:00: 8,234件
11:00-12:00: 9,567件
12:00-13:00: 6,789件
13:00-14:00: 7,456件

人気ページランキング:
1位: /index.html (5,678アクセス)
2位: /api/users (3,456アクセス)
3位: /login (2,234アクセス)
4位: /dashboard (1,987アクセス)
5位: /profile (1,567アクセス)

IPアドレス分析:
ユニークIP数: 2,456
トップアクセスIP:
192.168.1.100: 234アクセス
192.168.1.101: 198アクセス
192.168.1.102: 156アクセス

エラー分析:
エラーログ: error.log
重要度別:
ERROR: 123件
WARN: 456件
INFO: 12,345件

パフォーマンス:
処理時間: 1.23秒
処理速度: 40,650行/秒
メモリ使用量: 45MB（ストリーム処理）
```

**評価ポイント**:
- 正規表現を使った効率的な解析
- 大容量ファイルの処理最適化
- 統計処理とレポート生成

## 💡 ヒント

### 課題1のヒント
- Files.readAllLines() で簡単読み込み
- try-with-resources でリソース管理
- Charset.forName() でエンコーディング指定

### 課題2のヒント
- Files.walk() で再帰的走査
- Files.find() で条件検索
- DirectoryStream でメモリ効率良く一覧取得

### 課題3のヒント
- String.split(",") でCSV解析（簡易版）
- Stream API で集計処理
- NumberFormatException をキャッチしてエラー処理

### 課題4のヒント
- Pattern.compile() で正規表現をコンパイル
- Stream<String> で行単位処理
- Collectors.groupingBy() で集計

## 🔍 ファイルI/Oのポイント

1. **NIO.2 活用**: Files クラスで簡潔なファイル操作
2. **リソース管理**: try-with-resources で確実なクローズ
3. **エンコーディング**: 文字化けを防ぐ適切な指定
4. **パフォーマンス**: ストリーム処理で大容量ファイル対応
5. **例外処理**: IOException の適切なハンドリング
6. **メモリ効率**: BufferedReader/Writer でバッファリング

## ✅ 完了チェックリスト

- [ ] 課題1: 基本的なファイル読み書きができている
- [ ] 課題2: ディレクトリ操作とファイル検索ができている
- [ ] 課題3: CSVデータの処理ができている
- [ ] 課題4: ログファイルの解析ができている
- [ ] NIO.2 の Files クラスを適切に使用できている
- [ ] 大容量ファイルの効率的な処理ができている

**次のステップ**: 基本課題が完了したら、advanced/の発展課題でより高度なファイル処理に挑戦しましょう！