# 必須ワークフロー：原稿修正作業の標準手順

このドキュメントは、すべての原稿修正作業で**必ず従わなければならない**標準手順を定義します。

## 🚨 重要：この手順は省略不可

以下の手順を省略したり、順序を変更したりすることは**絶対に禁止**です。
CLAUDE.mdルール違反を防ぎ、品質を維持するために、厳格に遵守してください。

## 作業前の必須チェック（Phase 0）

```bash
# 1. 現在の準拠状況を確認
npm run check:compliance

# 2. 違反がある場合は先に解決
npm run fix:compliance  # 自動修正を試す
# 手動修正が必要な場合は対応

# 3. 再チェックして0件を確認
npm run check:compliance
```

**❌ 違反がある状態では作業を開始しない**

## 作業中の必須ルール（Phase 1-2）

### 絶対に使用してはいけないパターン

1. **リスト項目での強調とコロン**
   ```markdown
   ❌ - **保守性の低下**：同じロジックが...
   ✅ - 保守性の低下により、同じロジックが...
   ```

2. **コロン導入文**
   ```markdown
   ❌ 以下のような問題があります：
   ✅ 以下のような問題があります。主な問題は次の通りです。
   ```

3. **強調表記を見出しとして使用**
   ```markdown
   ❌ **重要なポイント**
   ✅ ### 重要なポイント
   ```

4. **「リスト」形式のコード番号**
   ```markdown
   ❌ **リスト5-1**
   ✅ **サンプルコード5-1**
   ```

### リアルタイムチェック

文章を書く際は、以下を常に意識：
- 本文：ですます調
- リスト項目：である調
- 強調表記（**太字**）の使用は最小限に
- コロン（：）の使用は慎重に

## 作業後の必須チェック（Phase 3）

```bash
# 1. CLAUDE.mdルール準拠性チェック（最優先）
npm run check:compliance

# 違反がある場合は必ず修正
npm run fix:compliance  # 自動修正を試す
# 手動修正が必要な場合は対応
npm run check:compliance  # 再チェック

# 2. textlintチェック
npm run lint manuscripts/chapter[修正した章番号]-*.md

# 3. 統合チェック
npm run pre-commit
```

**❌ 違反がある状態でコミットしない**

## Git コミット時の自動チェック

pre-commitフックにより、以下が自動実行されます：

1. `npm run check:compliance`
2. `npm run lint`

違反がある場合、コミットは自動的に中止されます。

```bash
# コミット例
git add .
git commit -m "第5章：継承とポリモーフィズムの説明を改善"
# → 自動的にCLAUDE.mdチェックとtextlintが実行される
```

## 違反が発見された場合の対処

### 1. 自動修正を試す
```bash
npm run fix:compliance
```

### 2. 手動修正が必要な場合
スクリプトが出力する詳細レポートを確認し、以下を手動修正：

- リスト項目の強調表記とコロンの組み合わせ
- 強調表記を見出しとして使用している箇所
- 複雑なコロン導入文

### 3. 修正後の確認
```bash
npm run check:compliance
```

## 緊急時の対応

どうしても違反を解決できない場合：

1. **作業を中断**
2. **現在の状態をバックアップ**
3. **ユーザーに相談**

```bash
# バックアップの作成
cp manuscripts/chapter[XX]-*.md manuscripts/chapter[XX]-*.md.emergency-backup
```

## 品質管理の責任

### 個人の責任
- 各作業者は、この手順を厳格に遵守する
- 違反を発見した場合は、必ず修正してから作業を継続する
- 不明な点があれば、作業を中断して確認する

### チームの責任
- pre-commitフックを無効化しない
- 修正プロトコルの変更は、全員の合意を得る
- 違反の蓄積を放置しない

## トラブルシューティング

### よくある問題

1. **「エラーはあるが急いでいる」**
   → **絶対に許可されません**。品質を犠牲にしてはいけません。

2. **「自動修正が効かない」**
   → 手動修正が必要です。作業を中断して対応してください。

3. **「pre-commitが重い」**
   → 品質保証のため必要です。事前チェックで負荷を軽減できます。

## まとめ

この必須ワークフローは、CLAUDE.mdルール違反の再発を防ぎ、書籍の品質を維持するための最重要プロセスです。

**すべての原稿修正作業で、例外なく従ってください。**

---

関連ドキュメント：
- [manuscript-modification-protocol.md](./manuscript-modification-protocol.md)
- [claude-md-compliance-guide.md](./claude-md-compliance-guide.md)
- [writing-guidelines-textlint-compliance.md](./writing-guidelines-textlint-compliance.md)