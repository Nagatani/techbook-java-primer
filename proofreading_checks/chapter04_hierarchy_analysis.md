# 第4章 階層構造分析と修正提案

## 現在の階層構造の問題点

### 問題1: 階層レベルの不整合

「銀行口座クラスの段階的な改善」セクションで確認された構造：

```
## 実践的なクラス設計例（H2）
├── ### 銀行口座クラスの段階的な改善（H3）
│   ├── #### ステップ1: 基本的なカプセル化（H4）
│   ├── #### ステップ2: データ検証の追加（H4）
│   │   ├── #### 実行結果（H4）← 問題：同じレベル
│   │   ├── #### 改善点（H4）← 問題：同じレベル
│   │   └── #### 残る問題（H4）← 問題：同じレベル
│   └── #### ステップ3: 完全なカプセル化（H4）
```

**問題**: 「実行結果」「改善点」「残る問題」がステップ2と同じH4レベルになっているため、階層関係が不明確。

### 問題2: コロンパターンの扱い

現在、以下のコロンパターンが一律H4に変換されています：

1. **「実行結果：」**
   - 出現箇所：サンプルコードの直後
   - 現状：#### 実行結果
   - 問題：コードブロックの説明として機能しており、独立した見出しとしては過剰

2. **「使用例：」「使用例と実行結果：」**
   - 出現箇所：クラスやメソッドの説明後
   - 現状：#### 使用例
   - 問題：短い例の場合、見出しとしては過剰

3. **「問題：」「解決策：」**
   - 出現箇所：エラーパターンの説明
   - 現状：#### 問題、#### 解決策
   - 問題：エラーパターンごとの説明なので、より下位のレベルが適切

## 修正提案

### 提案1: ステップ内の項目の階層調整

```
#### ステップ2: データ検証の追加（BankAccountV2）

[サンプルコード]

実行結果：
```
初期残高: 10000.0
...
```

**改善点**
- コンストラクタで初期値を検証
- 入金時に金額を検証
- 出金時に残高と金額を確認

**残る問題**
- 口座番号が後から変更可能
- 取引履歴が残らない
- 口座番号の検証がない
```

### 提案2: エラーセクションの構造

```
### 本章特有のエラー

#### 1. コンストラクタ関連のエラー（統合版）

**問題**: コンストラクタの定義や使用方法を誤る

[サンプルコード]

**解決策**:
[サンプルコード]

**重要なポイント**:
- カスタムコンストラクタを定義すると...
- コンストラクタには戻り値型を指定しない
- this()でコンストラクタチェーンを活用
```

## 確認事項

1. **実行結果の扱い**
   - 見出しとして独立させるか、説明文として扱うか
   - 「実行結果：」という表記自体を削除するか

2. **ステップ内の小項目**
   - H5レベルを使用するか、強調表現（太字）で済ませるか
   - リスト形式との使い分け

3. **エラーパターンの構造**
   - 問題/解決策を見出しにするか、強調表現にするか
   - 番号付きのエラーパターンごとの階層

4. **一貫性の確保**
   - 他の章での同様のパターンとの整合性
   - 全書を通じた統一的な扱い

## 推奨する修正方針

1. **最小限の見出し使用**：見出しの乱用を避け、本当に必要な構造のみ見出し化
2. **強調表現の活用**：短い項目は太字や箇条書きで十分
3. **階層の明確化**：親子関係が明確になるよう、適切なレベルを選択
4. **可読性の優先**：機械的な変換ではなく、読みやすさを重視