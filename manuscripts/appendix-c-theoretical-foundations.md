# ä»˜éŒ²C: ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢å·¥å­¦ã®ç†è«–çš„åŸºç›¤<small>è¨­è¨ˆåŸå‰‡ã¨å“è³ªãƒ¡ãƒˆãƒªã‚¯ã‚¹</small>

## æœ¬ä»˜éŒ²ã®ç›®çš„

ã“ã®ä»˜éŒ²ã§ã¯ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å‘ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã¨ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢è¨­è¨ˆã®ç†è«–çš„åŸºç›¤ã«ã¤ã„ã¦è©³ã—ãè§£èª¬ã—ã¾ã™ã€‚ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢å·¥å­¦ã®åŸºæœ¬åŸå‰‡ã€è¨­è¨ˆç†è«–ã€å“è³ªãƒ¡ãƒˆãƒªã‚¯ã‚¹ãªã©ã‚’é€šã˜ã¦ã€ãªãœç‰¹å®šã®ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ‰‹æ³•ãŒæ¨å¥¨ã•ã‚Œã‚‹ã®ã‹ã‚’ç†è«–çš„ã«ç†è§£ã™ã‚‹ã“ã¨ã‚’ç›®çš„ã¨ã—ã¦ã„ã¾ã™ã€‚

## ç« ã¨ã®ãƒãƒƒãƒ”ãƒ³ã‚°

å„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¯æœ¬æ–‡ã®è¨­è¨ˆæ¦‚å¿µã¨ç†è«–çš„ã«é€£å‹•ã—ã¦ã„ã¾ã™ï¼š

- **C.1 ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚¯ãƒ©ã‚¤ã‚·ã‚¹**: ç¬¬3ç« ï¼ˆOOPå¿…è¦æ€§ï¼‰ã®ç†è«–çš„èƒŒæ™¯
- **C.2 è¨­è¨ˆåŸå‰‡**: ç¬¬4ç« ï¼ˆã‚«ãƒ—ã‚»ãƒ«åŒ–ï¼‰ãƒ»ç¬¬8ç« ï¼ˆè¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰ã®åŸºç¤ç†è«–
- **C.3 è¤‡é›‘åº¦ç†è«–**: ç¬¬6ç« ï¼ˆãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ï¼‰ãƒ»ç¬¬7ç« ï¼ˆç¶™æ‰¿ï¼‰ã®è¨­è¨ˆæŒ‡é‡
- **C.4 å“è³ªãƒ¡ãƒˆãƒªã‚¯ã‚¹**: ç¬¬22ç« ï¼ˆãƒ†ã‚¹ãƒˆï¼‰ã®ç†è«–çš„åŸºç›¤
- **C.5 ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ç†è«–**: ç¬¬21ç« ï¼ˆMVCï¼‰ã®è¨­è¨ˆæ€æƒ³
- **C.6 å½¢å¼æ‰‹æ³•**: ç¬¬14ç« ï¼ˆä¾‹å¤–å‡¦ç†ï¼‰ã®å¥‘ç´„ç†è«–



## C.1 ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚¯ãƒ©ã‚¤ã‚·ã‚¹ã¨ãã®è§£æ±ºç­–

### C.1.1 ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚¯ãƒ©ã‚¤ã‚·ã‚¹ã®è©³ç´°åˆ†æ

1960å¹´ä»£ã‹ã‚‰1970å¹´ä»£ã«ã‹ã‘ã¦é¡•åœ¨åŒ–ã—ãŸã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚¯ãƒ©ã‚¤ã‚·ã‚¹ã¯ã€å˜ãªã‚‹æŠ€è¡“çš„å•é¡Œã§ã¯ãªãã€ã‚·ã‚¹ãƒ†ãƒ å·¥å­¦çš„ãªèª²é¡Œã§ã—ãŸã€‚

#### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå¤±æ•—ã®å…¸å‹çš„ãƒ‘ã‚¿ãƒ¼ãƒ³

**IBM System/360 OSé–‹ç™ºï¼ˆ1960å¹´ä»£ï¼‰**
- äºˆç®—ï¼šå½“åˆ5000ä¸‡ãƒ‰ãƒ« â†’ æœ€çµ‚5å„„ãƒ‰ãƒ«ï¼ˆ10å€è¶…éï¼‰
- æœŸé–“ï¼š2å¹´äºˆå®š â†’ 4å¹´ä»¥ä¸Š
- å“è³ªï¼šãƒªãƒªãƒ¼ã‚¹å¾Œã‚‚æ·±åˆ»ãªãƒã‚°ãŒå¤šæ•°ç™ºè¦‹

**åŸå› åˆ†æ**ï¼š
1. **è¤‡é›‘æ€§ã®æŒ‡æ•°çš„å¢—å¤§**: æ©Ÿèƒ½æ•°ã®å¢—åŠ ã«å¯¾ã—ã¦ãƒã‚°æ•°ãŒæŒ‡æ•°çš„ã«å¢—åŠ 
2. **ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ã‚¹ãƒˆ**: ãƒãƒ¼ãƒ ã‚µã‚¤ã‚ºnã«å¯¾ã—ã¦ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³çµŒè·¯ãŒn(n-1)/2ã§å¢—åŠ 
3. **å¤‰æ›´ã®æ³¢åŠåŠ¹æœ**: 1ç®‡æ‰€ã®å¤‰æ›´ãŒäºˆæœŸã—ãªã„è¤‡æ•°ãƒµæ‰€ã«å½±éŸ¿

#### ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã®è¤‡é›‘æ€§ãƒ¡ãƒˆãƒªã‚¯ã‚¹

**å¾ªç’°çš„è¤‡é›‘åº¦ï¼ˆCyclomatic Complexityï¼‰**
<span class="listing-number">**ãƒªã‚¹ãƒˆAC-1**</span>

```java
// è¤‡é›‘åº¦ãŒé«˜ã„ã‚³ãƒ¼ãƒ‰ä¾‹ï¼ˆè¤‡é›‘åº¦: 6ï¼‰
public String processData(int type, boolean flag, String data) {
    if (type == 1) {                    // +1
        if (flag) {                     // +1
            if (data.length() > 10) {   // +1
                return "Type1-Long";
            } else {                    // +1
                return "Type1-Short";
            }
        } else {                        // +1
            return "Type1-Default";
        }
    } else if (type == 2) {             // +1
        return "Type2";
    }
    return "Unknown";
}
```

**æ”¹å–„å¾Œï¼ˆè¤‡é›‘åº¦: 3ï¼‰**
<span class="listing-number">**ãƒªã‚¹ãƒˆAC-2**</span>

```java
public String processData(int type, boolean flag, String data) {
    switch (type) {                     // +1
        case 1:
            return processType1(flag, data);
        case 2:
            return "Type2";
        default:
            return "Unknown";
    }
}

private String processType1(boolean flag, String data) {
    if (!flag) return "Type1-Default"; // +1
    return data.length() > 10          // +1
        ? "Type1-Long" 
        : "Type1-Short";
}
```

### C.1.2 æ§‹é€ åŒ–ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã®ç†è«–çš„åŸºç›¤

#### Dijkstraã®æ§‹é€ åŒ–å®šç†

ä»»æ„ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã¯ä»¥ä¸‹ã®3ã¤ã®åˆ¶å¾¡æ§‹é€ ã®çµ„ã¿åˆã‚ã›ã§è¡¨ç¾å¯èƒ½ï¼š

1. **é †æ¬¡å‡¦ç†ï¼ˆSequenceï¼‰**
<span class="listing-number">**ãƒªã‚¹ãƒˆAC-3**</span>

```java
statement1;
statement2;
statement3;
```

2. **åˆ†å²å‡¦ç†ï¼ˆSelectionï¼‰**
<span class="listing-number">**ãƒªã‚¹ãƒˆAC-4**</span>

```java
if (condition) {
    statementA;
} else {
    statementB;
}
```

3. **åå¾©å‡¦ç†ï¼ˆIterationï¼‰**
<span class="listing-number">**ãƒªã‚¹ãƒˆAC-5**</span>

```java
while (condition) {
    statements;
}
```

#### å½¢å¼çš„è¨¼æ˜ã¨ä¸å¤‰æ¡ä»¶

**ãƒ«ãƒ¼ãƒ—ä¸å¤‰æ¡ä»¶ã®ä¾‹**
<span class="listing-number">**ãƒªã‚¹ãƒˆAC-6**</span>

```java
// é…åˆ—ã®æœ€å¤§å€¤ã‚’æ±‚ã‚ã‚‹ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 
public int findMax(int[] array) {
    if (array.length == 0) throw new IllegalArgumentException();
    
    int max = array[0];
    int i = 1;
    
    // ãƒ«ãƒ¼ãƒ—ä¸å¤‰æ¡ä»¶: max ã¯ array[0..i-1] ã®æœ€å¤§å€¤
    while (i < array.length) {
        if (array[i] > max) {
            max = array[i];
        }
        i++;
        // ä¸å¤‰æ¡ä»¶ã¯ä¿æŒã•ã‚Œã‚‹
    }
    
    return max; // max ã¯ array[0..length-1] ã®æœ€å¤§å€¤
}
```



## C.2 ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å‘ã®ç†è«–çš„åŸºç›¤

### C.2.1 æŠ½è±¡ãƒ‡ãƒ¼ã‚¿å‹ï¼ˆADTï¼‰ã®ç†è«–

#### ADTã®æ•°å­¦çš„å®šç¾©

æŠ½è±¡ãƒ‡ãƒ¼ã‚¿å‹ã¯ä»¥ä¸‹ã®è¦ç´ ã§æ§‹æˆã•ã‚Œã‚‹ï¼š
- **ã‚­ãƒ£ãƒªã‚¢é›†åˆï¼ˆCarrier Setï¼‰**: ãƒ‡ãƒ¼ã‚¿ã®å€¤åŸŸ
- **æ“ä½œé›†åˆï¼ˆOperation Setï¼‰**: ãƒ‡ãƒ¼ã‚¿ã«å¯¾ã™ã‚‹æ“ä½œ
- **å…¬ç†ç³»ï¼ˆAxiom Systemï¼‰**: æ“ä½œã®æ€§è³ªã‚’å®šç¾©ã™ã‚‹è¦å‰‡

**ã‚¹ã‚¿ãƒƒã‚¯ADTã®ä¾‹**
<span class="listing-number">**ãƒªã‚¹ãƒˆAC-7**</span>

```java
// ã‚¹ã‚¿ãƒƒã‚¯ã®æŠ½è±¡ä»•æ§˜
public interface Stack<T> {
    // æ“ä½œ
    void push(T item);      // push: Stack Ã— T â†’ Stack
    T pop();               // pop: Stack â†’ T Ã— Stack  
    T peek();              // peek: Stack â†’ T
    boolean isEmpty();     // isEmpty: Stack â†’ Boolean
    
    // å…¬ç†ï¼ˆã‚³ãƒ¡ãƒ³ãƒˆã§è¡¨ç¾ï¼‰
    // 1. pop(push(s, x)) = s
    // 2. peek(push(s, x)) = x
    // 3. isEmpty(new Stack()) = true
    // 4. isEmpty(push(s, x)) = false
}

// å…·ä½“å®Ÿè£…
public class ArrayStack<T> implements Stack<T> {
    private T[] array;
    private int top;
    
    @SuppressWarnings("unchecked")
    public ArrayStack(int capacity) {
        array = (T[]) new Object[capacity];
        top = -1;
    }
    
    public void push(T item) {
        if (top >= array.length - 1) {
            throw new StackOverflowError();
        }
        array[++top] = item;
    }
    
    public T pop() {
        if (isEmpty()) {
            throw new EmptyStackException();
        }
        T item = array[top];
        array[top--] = null; // ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯é˜²æ­¢
        return item;
    }
    
    public T peek() {
        if (isEmpty()) {
            throw new EmptyStackException();
        }
        return array[top];
    }
    
    public boolean isEmpty() {
        return top == -1;
    }
}
```

### C.2.2 ã‚«ãƒ—ã‚»ãƒ«åŒ–ã®ç†è«–çš„æ„ç¾©

#### æƒ…å ±éš è”½ã®åŸå‰‡ï¼ˆParnas, 1972ï¼‰

**ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åˆ†å‰²ã®åŸºæº–**ï¼š
- å„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯å¤‰æ›´ã•ã‚Œã‚„ã™ã„è¨­è¨ˆæ±ºå®šã‚’éš è”½ã™ã‚‹
- ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ã‚¤ã‚¹ã¯å®‰å®šçš„ã§æœ€å°é™ã«ä¿ã¤
- å®Ÿè£…ã®è©³ç´°ã¯å¤–éƒ¨ã‹ã‚‰è¦‹ãˆãªã„ã‚ˆã†ã«ã™ã‚‹

**æ‚ªã„ä¾‹ï¼šå®Ÿè£…è©³ç´°ã®éœ²å‡º**
<span class="listing-number">**ãƒªã‚¹ãƒˆAC-8**</span>

```java
public class BadBankAccount {
    public double[] transactionHistory; // å®Ÿè£…è©³ç´°ã®éœ²å‡º
    public int transactionCount;        // ä¸å¤‰æ¡ä»¶ã®ç ´ç¶»å¯èƒ½æ€§
    
    public void addTransaction(double amount) {
        // é…åˆ—ã‚µã‚¤ã‚ºãƒã‚§ãƒƒã‚¯ãªã— - ãƒã‚°ã®æ¸©åºŠ
        transactionHistory[transactionCount++] = amount;
    }
}
```

**è‰¯ã„ä¾‹ï¼šé©åˆ‡ãªã‚«ãƒ—ã‚»ãƒ«åŒ–**
<span class="listing-number">**ãƒªã‚¹ãƒˆAC-9**</span>

```java
public class GoodBankAccount {
    private List<Transaction> transactions; // å®Ÿè£…è©³ç´°ã‚’éš è”½
    private double balance;
    
    public void deposit(double amount) {
        if (amount <= 0) {
            throw new IllegalArgumentException("Amount must be positive");
        }
        transactions.add(new Transaction("DEPOSIT", amount));
        balance += amount;
        // ä¸å¤‰æ¡ä»¶: balance = sum of all transactions
    }
    
    public double getBalance() {
        return balance; // è¨ˆç®—çµæœã®ã‚³ãƒ”ãƒ¼ã‚’è¿”ã™
    }
    
    public List<Transaction> getTransactionHistory() {
        return List.copyOf(transactions); // ä¸å¤‰ãƒ“ãƒ¥ãƒ¼ã‚’è¿”ã™
    }
}
```

### C.2.3 ç¶™æ‰¿ã¨ãƒªã‚¹ã‚³ãƒ•ã®ç½®æ›åŸå‰‡

#### LSPï¼ˆLiskov Substitution Principleï¼‰ã®å½¢å¼çš„å®šç¾©

å‹SãŒå‹Tã®ã‚µãƒ–ã‚¿ã‚¤ãƒ—ã§ã‚ã‚‹å ´åˆã€ãƒ—ãƒ­ã‚°ãƒ©ãƒ å†…ã§Tå‹ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒä½¿ã‚ã‚Œã¦ã„ã‚‹ç®‡æ‰€ã¯ã€ã™ã¹ã¦Så‹ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ç½®ãæ›ãˆå¯èƒ½ã§ãªã‘ã‚Œã°ãªã‚‰ãªã„ã€‚

**LSPé•åã®ä¾‹**
<span class="listing-number">**ãƒªã‚¹ãƒˆAC-10**</span>

```java
class Rectangle {
    protected int width, height;
    
    public void setWidth(int width) {
        this.width = width;
    }
    
    public void setHeight(int height) {
        this.height = height;
    }
    
    public int getArea() {
        return width * height;
    }
}

class Square extends Rectangle {
    @Override
    public void setWidth(int width) {
        this.width = this.height = width; // å‰ææ¡ä»¶ã‚’å¤‰æ›´
    }
    
    @Override
    public void setHeight(int height) {
        this.width = this.height = height; // å‰ææ¡ä»¶ã‚’å¤‰æ›´
    }
}

// LSPé•åã‚’ç¤ºã™ãƒ†ã‚¹ãƒˆ
public void testLSPViolation() {
    Rectangle rect = new Square(); // ã‚µãƒ–ã‚¿ã‚¤ãƒ—ã§ç½®æ›
    rect.setWidth(5);
    rect.setHeight(4);
    
    // Rectangle ã§ã¯ 20 ã‚’æœŸå¾…ã™ã‚‹ãŒã€Square ã§ã¯ 16 ã«ãªã‚‹
    assert rect.getArea() == 20; // å¤±æ•—ï¼
}
```

**LSPéµå®ˆã®è¨­è¨ˆ**
<span class="listing-number">**ãƒªã‚¹ãƒˆAC-11**</span>

```java
interface Shape {
    int getArea();
    Shape resize(double factor);
}

class Rectangle implements Shape {
    private final int width, height;
    
    public Rectangle(int width, int height) {
        this.width = width;
        this.height = height;
    }
    
    public int getArea() {
        return width * height;
    }
    
    public Shape resize(double factor) {
        return new Rectangle(
            (int)(width * factor), 
            (int)(height * factor)
        );
    }
}

class Square implements Shape {
    private final int side;
    
    public Square(int side) {
        this.side = side;
    }
    
    public int getArea() {
        return side * side;
    }
    
    public Shape resize(double factor) {
        return new Square((int)(side * factor));
    }
}
```



## C.3 ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢å“è³ªãƒ¡ãƒˆãƒªã‚¯ã‚¹

### C.3.1 çµåˆåº¦ï¼ˆCouplingï¼‰ã®åˆ†é¡

#### çµåˆåº¦ã®éšå±¤ï¼ˆå¼±ã„é †ï¼‰

1. **ãƒ‡ãƒ¼ã‚¿çµåˆï¼ˆData Couplingï¼‰**
<span class="listing-number">**ãƒªã‚¹ãƒˆAC-12**</span>

```java
// æœ€ã‚‚å¼±ã„çµåˆ - åŸºæœ¬ãƒ‡ãƒ¼ã‚¿ã®ã¿ã‚’æ¸¡ã™
public double calculateTax(double income, double rate) {
    return income * rate;
}
```

2. **ã‚¹ã‚¿ãƒ³ãƒ—çµåˆï¼ˆStamp Couplingï¼‰**
<span class="listing-number">**ãƒªã‚¹ãƒˆAC-13**</span>

```java
// ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‚’æ¸¡ã™ãŒã€å…¨ä½“ã‚’ä½¿ç”¨
public double calculateTax(TaxInfo taxInfo) {
    return taxInfo.getIncome() * taxInfo.getRate();
}
```

3. **åˆ¶å¾¡çµåˆï¼ˆControl Couplingï¼‰**
<span class="listing-number">**ãƒªã‚¹ãƒˆAC-14**</span>

```java
// æ‚ªã„ä¾‹ï¼šåˆ¶å¾¡ãƒ•ãƒ©ã‚°ã‚’æ¸¡ã™
public void processData(Data data, int mode) {
    if (mode == 1) {
        // å‡¦ç†A
    } else if (mode == 2) {
        // å‡¦ç†B
    }
}

// è‰¯ã„ä¾‹ï¼šãƒãƒªãƒ¢ãƒ¼ãƒ•ã‚£ã‚ºãƒ ã‚’ä½¿ç”¨
public interface DataProcessor {
    void process(Data data);
}
```

4. **å…±é€šçµåˆï¼ˆCommon Couplingï¼‰**
<span class="listing-number">**ãƒªã‚¹ãƒˆAC-15**</span>

```java
// æ‚ªã„ä¾‹ï¼šã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã¸ã®ä¾å­˜
public class OrderProcessor {
    public void processOrder() {
        GlobalConfig.getInstance().getDatabase().save(order);
    }
}

// è‰¯ã„ä¾‹ï¼šä¾å­˜æ€§æ³¨å…¥
public class OrderProcessor {
    private final Database database;
    
    public OrderProcessor(Database database) {
        this.database = database;
    }
    
    public void processOrder(Order order) {
        database.save(order);
    }
}
```

### C.3.2 å‡é›†åº¦ï¼ˆCohesionï¼‰ã®åˆ†é¡

#### å‡é›†åº¦ã®éšå±¤ï¼ˆå¼·ã„é †ï¼‰

1. **æ©Ÿèƒ½çš„å‡é›†ï¼ˆFunctional Cohesionï¼‰**
<span class="listing-number">**ãƒªã‚¹ãƒˆAC-16**</span>

```java
// å˜ä¸€ã®æ©Ÿèƒ½ã«ç‰¹åŒ–
public class PrimeChecker {
    public boolean isPrime(int number) {
        if (number < 2) return false;
        for (int i = 2; i <= Math.sqrt(number); i++) {
            if (number % i == 0) return false;
        }
        return true;
    }
}
```

2. **é€æ¬¡çš„å‡é›†ï¼ˆSequential Cohesionï¼‰**
<span class="listing-number">**ãƒªã‚¹ãƒˆAC-17**</span>

```java
// å‡ºåŠ›ãŒæ¬¡ã®å…¥åŠ›ã«ãªã‚‹å‡¦ç†ã®é€£é–
public class DataProcessor {
    public ProcessedData process(RawData raw) {
        CleanedData cleaned = clean(raw);
        ValidatedData validated = validate(cleaned);
        return transform(validated);
    }
    
    private CleanedData clean(RawData raw) { /* */ }
    private ValidatedData validate(CleanedData cleaned) { /* */ }
    private ProcessedData transform(ValidatedData validated) { /* */ }
}
```

3. **å¶ç™ºçš„å‡é›†ï¼ˆCoincidental Cohesionï¼‰** - é¿ã‘ã‚‹ã¹ã
<span class="listing-number">**ãƒªã‚¹ãƒˆAC-18**</span>

```java
// æ‚ªã„ä¾‹ï¼šé–¢é€£ã®ãªã„æ©Ÿèƒ½ã®å¯„ã›é›†ã‚
public class Utilities {
    public String formatDate(Date date) { /* */ }
    public double calculateTax(double income) { /* */ }
    public void sendEmail(String to, String subject) { /* */ }
    public int[] sortArray(int[] array) { /* */ }
}
```



## ğŸ”„ C.4 è¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³ã®ç†è«–çš„åˆ†æ

### C.4.1 GoFãƒ‘ã‚¿ãƒ¼ãƒ³ã®åˆ†é¡ç†è«–

#### ç”Ÿæˆãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆCreational Patternsï¼‰
ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ç”Ÿæˆã«é–¢ã™ã‚‹å•é¡Œã‚’è§£æ±ºï¼š

**Singletonãƒ‘ã‚¿ãƒ¼ãƒ³ã®ç†è«–çš„åˆ†æ**
<span class="listing-number">**ãƒªã‚¹ãƒˆAC-19**</span>

```java
// ã‚¹ãƒ¬ãƒƒãƒ‰ã‚»ãƒ¼ãƒ•ãªSingletonå®Ÿè£…
public class DatabaseConnection {
    private static volatile DatabaseConnection instance;
    private static final Object lock = new Object();
    
    private DatabaseConnection() {
        // åˆæœŸåŒ–å‡¦ç†
    }
    
    public static DatabaseConnection getInstance() {
        if (instance == null) {
            synchronized (lock) {
                if (instance == null) {
                    instance = new DatabaseConnection();
                }
            }
        }
        return instance;
    }
}

// Enum ã«ã‚ˆã‚‹å®Ÿè£…ï¼ˆæ¨å¥¨ï¼‰
public enum DatabaseConnection {
    INSTANCE;
    
    public void executeQuery(String sql) {
        // ã‚¯ã‚¨ãƒªå®Ÿè¡Œ
    }
}
```

**ç†è«–çš„è€ƒå¯Ÿ**ï¼š
- ãƒ¡ãƒ¢ãƒªå¯è¦–æ€§ã®å•é¡Œï¼ˆvolatileä¿®é£¾å­ã®å¿…è¦æ€§ï¼‰
- Double-checked lockingãƒ‘ã‚¿ãƒ¼ãƒ³ã®æ­£å½“æ€§
- åˆæœŸåŒ–ã®thread-safety

#### æ§‹é€ ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆStructural Patternsï¼‰

**Decoratorãƒ‘ã‚¿ãƒ¼ãƒ³ã®æ•°å­¦çš„ãƒ¢ãƒ‡ãƒ«**
<span class="listing-number">**ãƒªã‚¹ãƒˆAC-20**</span>

```java
// Component = åŸºæœ¬æ©Ÿèƒ½ã®æŠ½è±¡åŒ–
interface Coffee {
    double getCost();
    String getDescription();
}

// ConcreteComponent = åŸºæœ¬å®Ÿè£…
class SimpleCoffee implements Coffee {
    public double getCost() { return 1.0; }
    public String getDescription() { return "Simple Coffee"; }
}

// Decorator = è£…é£¾ã®æŠ½è±¡åŒ–
abstract class CoffeeDecorator implements Coffee {
    protected Coffee coffee;
    
    public CoffeeDecorator(Coffee coffee) {
        this.coffee = coffee;
    }
}

// ConcreteDecorator = å…·ä½“çš„ãªè£…é£¾
class MilkDecorator extends CoffeeDecorator {
    public MilkDecorator(Coffee coffee) { super(coffee); }
    
    public double getCost() {
        return coffee.getCost() + 0.5; // f(x) = x + 0.5
    }
    
    public String getDescription() {
        return coffee.getDescription() + ", Milk";
    }
}

// ä½¿ç”¨ä¾‹: é–¢æ•°åˆæˆ g(f(x))
Coffee coffee = new MilkDecorator(
    new SugarDecorator(
        new SimpleCoffee()
    )
);
```

#### æŒ¯ã‚‹èˆã„ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆBehavioral Patternsï¼‰

**Observerãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ã‚¤ãƒ™ãƒ³ãƒˆä»£æ•°**
<span class="listing-number">**ãƒªã‚¹ãƒˆAC-21**</span>

```java
// Subject = è¦³å¯Ÿã•ã‚Œã‚‹å¯¾è±¡
public class Stock {
    private String symbol;
    private double price;
    private List<Observer> observers = new ArrayList<>();
    
    public void addObserver(Observer observer) {
        observers.add(observer);
    }
    
    public void removeObserver(Observer observer) {
        observers.remove(observer);
    }
    
    public void setPrice(double price) {
        this.price = price;
        notifyObservers(); // ã‚¤ãƒ™ãƒ³ãƒˆç™ºç«
    }
    
    private void notifyObservers() {
        for (Observer observer : observers) {
            observer.update(this);
        }
    }
}

// Observer = è¦³å¯Ÿè€…ã®æŠ½è±¡åŒ–
interface Observer {
    void update(Stock stock);
}

// ConcreteObserver = å…·ä½“çš„ãªè¦³å¯Ÿè€…
class StockDisplay implements Observer {
    public void update(Stock stock) {
        System.out.println("Stock price updated: " + stock.getPrice());
    }
}
```

**ç†è«–çš„è€ƒå¯Ÿ**ï¼š
- ã‚¤ãƒ™ãƒ³ãƒˆ-ãƒªã‚¹ãƒŠãƒ‘ã‚¿ãƒ¼ãƒ³ã®æ•°å­¦çš„ãƒ¢ãƒ‡ãƒ«
- é€šçŸ¥ã®é †åºä¿è¨¼æ€§
- ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯ã®é˜²æ­¢ï¼ˆWeakReferenceï¼‰



## ğŸ“ C.5 ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ è§£æã¨è¨­è¨ˆ

### C.5.1 è¨ˆç®—è¤‡é›‘åº¦ç†è«–

#### æ™‚é–“è¤‡é›‘åº¦ã®å³å¯†ãªå®šç¾©

**å¤§Oè¨˜æ³•ï¼ˆBig-O Notationï¼‰**
f(n) = O(g(n)) âŸº âˆƒc > 0, âˆƒnâ‚€ > 0, âˆ€n â‰¥ nâ‚€: f(n) â‰¤ cÂ·g(n)

<span class="listing-number">**ãƒªã‚¹ãƒˆAC-22**</span>

```java
// O(nÂ²) ã®ä¾‹ï¼šãƒãƒ–ãƒ«ã‚½ãƒ¼ãƒˆ
public void bubbleSort(int[] arr) {
    int n = arr.length;
    for (int i = 0; i < n - 1; i++) {        // n-1 å›
        for (int j = 0; j < n - i - 1; j++) { // (n-1) + (n-2) + ... + 1 å›
            if (arr[j] > arr[j + 1]) {
                int temp = arr[j];
                arr[j] = arr[j + 1];
                arr[j + 1] = temp;
            }
        }
    }
    // ç·æ¯”è¼ƒå›æ•°: Î£(i=1 to n-1) i = n(n-1)/2 = O(nÂ²)
}

// O(n log n) ã®ä¾‹ï¼šãƒãƒ¼ã‚¸ã‚½ãƒ¼ãƒˆ
public void mergeSort(int[] arr, int left, int right) {
    if (left < right) {
        int mid = left + (right - left) / 2;
        
        mergeSort(arr, left, mid);      // T(n/2)
        mergeSort(arr, mid + 1, right); // T(n/2)
        merge(arr, left, mid, right);   // O(n)
    }
    // æ¼¸åŒ–å¼: T(n) = 2T(n/2) + O(n)
    // è§£: T(n) = O(n log n) ï¼ˆãƒã‚¹ã‚¿ãƒ¼å®šç†ã‚ˆã‚Šï¼‰
}
```

#### ç©ºé–“è¤‡é›‘åº¦ã®åˆ†æ

<span class="listing-number">**ãƒªã‚¹ãƒˆAC-23**</span>

```java
// O(1) ç©ºé–“ï¼šin-place ã‚½ãƒ¼ãƒˆ
public void quickSortIterative(int[] arr) {
    Stack<Integer> stack = new Stack<>();
    stack.push(0);
    stack.push(arr.length - 1);
    
    while (!stack.isEmpty()) {
        int high = stack.pop();
        int low = stack.pop();
        
        if (low < high) {
            int pivot = partition(arr, low, high);
            stack.push(low);
            stack.push(pivot - 1);
            stack.push(pivot + 1);
            stack.push(high);
        }
    }
    // ç©ºé–“: O(log n) (ã‚¹ã‚¿ãƒƒã‚¯ã®æœ€å¤§æ·±åº¦)
}

// O(n) ç©ºé–“ï¼šé…åˆ—ã‚’ã‚³ãƒ”ãƒ¼ã™ã‚‹ã‚½ãƒ¼ãƒˆ
public int[] mergeSortWithCopy(int[] arr) {
    if (arr.length <= 1) return arr.clone();
    
    int mid = arr.length / 2;
    int[] left = mergeSortWithCopy(Arrays.copyOf(arr, mid));
    int[] right = mergeSortWithCopy(Arrays.copyOfRange(arr, mid, arr.length));
    
    return merge(left, right);
    // ç©ºé–“: O(n) (å„ãƒ¬ãƒ™ãƒ«ã§nè¦ç´ ã®é…åˆ—ã‚’ä½œæˆ)
}
```

### C.5.2 ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®ç†è«–çš„åˆ†æ

#### å‹•çš„é…åˆ—ï¼ˆArrayListï¼‰ã®å„Ÿå´è§£æ

<span class="listing-number">**ãƒªã‚¹ãƒˆAC-24**</span>

```java
public class DynamicArray<T> {
    private Object[] array;
    private int size;
    private int capacity;
    
    public DynamicArray() {
        capacity = 1;
        array = new Object[capacity];
        size = 0;
    }
    
    public void add(T element) {
        if (size == capacity) {
            resize(); // O(n) ã ãŒé »åº¦ã¯ä½ã„
        }
        array[size++] = element; // O(1)
    }
    
    private void resize() {
        capacity *= 2; // å®¹é‡ã‚’å€å¢—
        Object[] newArray = new Object[capacity];
        System.arraycopy(array, 0, newArray, 0, size);
        array = newArray;
    }
}
```

**å„Ÿå´è§£æ**ï¼š
- resizeæ“ä½œã®é »åº¦ï¼š1, 2, 4, 8, 16, ..., 2â±
- nå›ã®addæ“ä½œã§resizeã¯logâ‚‚(n) å›ç™ºç”Ÿ
- ç·ã‚³ã‚¹ãƒˆï¼šn + (1 + 2 + 4 + ... + n) < n + 2n = 3n
- å„Ÿå´æ™‚é–“è¨ˆç®—é‡ï¼šO(3n/n) = O(1)

#### ãƒãƒƒã‚·ãƒ¥ãƒ†ãƒ¼ãƒ–ãƒ«ã®ç†è«–

<span class="listing-number">**ãƒªã‚¹ãƒˆAC-25**</span>

```java
public class HashTable<K, V> {
    private static class Entry<K, V> {
        K key;
        V value;
        Entry<K, V> next; // ãƒã‚§ã‚¤ãƒ³æ³•
        
        Entry(K key, V value) {
            this.key = key;
            this.value = value;
        }
    }
    
    private Entry<K, V>[] table;
    private int size;
    private int capacity;
    private static final double LOAD_FACTOR = 0.75;
    
    @SuppressWarnings("unchecked")
    public HashTable(int initialCapacity) {
        this.capacity = initialCapacity;
        this.table = new Entry[capacity];
    }
    
    public void put(K key, V value) {
        if (size >= capacity * LOAD_FACTOR) {
            resize(); // è² è·ç‡ã‚’ä¸€å®šä»¥ä¸‹ã«ä¿ã¤
        }
        
        int index = hash(key) % capacity;
        Entry<K, V> entry = table[index];
        
        // æ—¢å­˜ã‚­ãƒ¼ã®æ›´æ–°
        while (entry != null) {
            if (entry.key.equals(key)) {
                entry.value = value;
                return;
            }
            entry = entry.next;
        }
        
        // æ–°ã—ã„ã‚¨ãƒ³ãƒˆãƒªã®è¿½åŠ 
        Entry<K, V> newEntry = new Entry<>(key, value);
        newEntry.next = table[index];
        table[index] = newEntry;
        size++;
    }
    
    private int hash(K key) {
        // è‰¯ã„ãƒãƒƒã‚·ãƒ¥é–¢æ•°ã¯é‡è¦
        return Math.abs(key.hashCode());
    }
}
```

**ç†è«–çš„è€ƒå¯Ÿ**ï¼š
- æœŸå¾…æ¤œç´¢æ™‚é–“ï¼šO(1 + Î±)ï¼ˆÎ±ã¯è² è·ç‡ï¼‰
- æœ€æ‚ªæ™‚é–“ï¼šO(n)ï¼ˆã™ã¹ã¦ã®ã‚­ãƒ¼ãŒåŒã˜ãƒã‚±ãƒƒãƒˆã«ãƒãƒƒã‚·ãƒ¥ï¼‰
- å…¨åŸŸãƒãƒƒã‚·ãƒ¥ï¼ˆUniversal Hashingï¼‰ã«ã‚ˆã‚‹æœŸå¾…æ€§èƒ½ä¿è¨¼



## C.6 å½¢å¼æ‰‹æ³•ã¨ä»•æ§˜è¨˜è¿°

### C.6.1 äº‹å‰æ¡ä»¶ãƒ»äº‹å¾Œæ¡ä»¶ã«ã‚ˆã‚‹ä»•æ§˜è¨˜è¿°

#### ãƒ›ãƒ¼ã‚¢è«–ç†ï¼ˆHoare Logicï¼‰

{P} S {Q} ã®å½¢å¼ã§è¡¨ç¾ï¼š
- Pï¼šäº‹å‰æ¡ä»¶ï¼ˆPreconditionï¼‰
- Sï¼šæ–‡ï¼ˆStatementï¼‰
- Qï¼šäº‹å¾Œæ¡ä»¶ï¼ˆPostconditionï¼‰

<span class="listing-number">**ãƒªã‚¹ãƒˆAC-26**</span>

```java
/**
 * äºŒåˆ†æ¢ç´¢ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 
 * @param arr ã‚½ãƒ¼ãƒˆæ¸ˆã¿é…åˆ—
 * @param target æ¢ç´¢ã™ã‚‹å€¤
 * @return è¦‹ã¤ã‹ã£ãŸå ´åˆã¯ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã€è¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã¯-1
 * 
 * äº‹å‰æ¡ä»¶: arr != null && isSorted(arr)
 * äº‹å¾Œæ¡ä»¶: 
 *   result >= 0 => arr[result] == target
 *   result == -1 => âˆ€i. arr[i] != target
 */
public int binarySearch(int[] arr, int target) {
    int left = 0;
    int right = arr.length - 1;
    
    // ãƒ«ãƒ¼ãƒ—ä¸å¤‰æ¡ä»¶:
    // target ãŒå­˜åœ¨ã™ã‚‹ãªã‚‰ arr[left..right] ã®ç¯„å›²å†…ã«ã‚ã‚‹
    while (left <= right) {
        int mid = left + (right - left) / 2;
        
        if (arr[mid] == target) {
            return mid; // äº‹å¾Œæ¡ä»¶ã‚’æº€ãŸã™
        } else if (arr[mid] < target) {
            left = mid + 1;
        } else {
            right = mid - 1;
        }
    }
    
    return -1; // äº‹å¾Œæ¡ä»¶ã‚’æº€ãŸã™
}
```

### C.6.2 ä¸å¤‰æ¡ä»¶ï¼ˆInvariantï¼‰ã®è¨­è¨ˆ

#### ã‚¯ãƒ©ã‚¹ä¸å¤‰æ¡ä»¶ã®ä¾‹

<span class="listing-number">**ãƒªã‚¹ãƒˆAC-27**</span>

```java
public class BankAccount {
    private double balance;
    private List<Transaction> transactions;
    
    // ã‚¯ãƒ©ã‚¹ä¸å¤‰æ¡ä»¶:
    // balance == transactions.stream().mapToDouble(Transaction::getAmount).sum()
    
    public BankAccount(double initialBalance) {
        if (initialBalance < 0) {
            throw new IllegalArgumentException("Initial balance cannot be negative");
        }
        this.balance = initialBalance;
        this.transactions = new ArrayList<>();
        if (initialBalance > 0) {
            transactions.add(new Transaction("INITIAL", initialBalance));
        }
        // ä¸å¤‰æ¡ä»¶ã®ç¢ºç«‹
        assert checkInvariant();
    }
    
    public void deposit(double amount) {
        // äº‹å‰æ¡ä»¶
        if (amount <= 0) {
            throw new IllegalArgumentException("Amount must be positive");
        }
        
        // æ“ä½œ
        transactions.add(new Transaction("DEPOSIT", amount));
        balance += amount;
        
        // äº‹å¾Œæ¡ä»¶ã¨ä¸å¤‰æ¡ä»¶ã®ç¶­æŒ
        assert checkInvariant();
    }
    
    public void withdraw(double amount) {
        // äº‹å‰æ¡ä»¶
        if (amount <= 0) {
            throw new IllegalArgumentException("Amount must be positive");
        }
        if (balance < amount) {
            throw new InsufficientFundsException("Insufficient balance");
        }
        
        // æ“ä½œ
        transactions.add(new Transaction("WITHDRAW", -amount));
        balance -= amount;
        
        // äº‹å¾Œæ¡ä»¶ã¨ä¸å¤‰æ¡ä»¶ã®ç¶­æŒ
        assert checkInvariant();
    }
    
    private boolean checkInvariant() {
        double calculatedBalance = transactions.stream()
            .mapToDouble(Transaction::getAmount)
            .sum();
        return Math.abs(balance - calculatedBalance) < 0.001; // æµ®å‹•å°æ•°ç‚¹èª¤å·®ã‚’è€ƒæ…®
    }
}
```



## C.7 ä¸¦è¡Œãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã®ç†è«–

### C.7.1 ç«¶åˆçŠ¶æ…‹ï¼ˆRace Conditionï¼‰ã®å½¢å¼çš„åˆ†æ

#### ãƒ‡ãƒ¼ã‚¿ç«¶åˆã®å®šç¾©

2ã¤ã®ãƒ¡ãƒ¢ãƒªã‚¢ã‚¯ã‚»ã‚¹æ“ä½œãŒä»¥ä¸‹ã®æ¡ä»¶ã‚’æº€ãŸã™ã¨ãã€ãƒ‡ãƒ¼ã‚¿ç«¶åˆãŒç™ºç”Ÿï¼š
1. åŒã˜ãƒ¡ãƒ¢ãƒªä½ç½®ã«ã‚¢ã‚¯ã‚»ã‚¹
2. å°‘ãªãã¨ã‚‚ä¸€æ–¹ãŒæ›¸ãè¾¼ã¿æ“ä½œ
3. åŒæœŸæ©Ÿæ§‹ã«ã‚ˆã£ã¦é †åºä»˜ã‘ã•ã‚Œã¦ã„ãªã„
4. ç•°ãªã‚‹ã‚¹ãƒ¬ãƒƒãƒ‰ã§å®Ÿè¡Œ

<span class="listing-number">**ãƒªã‚¹ãƒˆAC-28**</span>

```java
public class RaceConditionExample {
    private int counter = 0; // å…±æœ‰çŠ¶æ…‹
    
    // ãƒ‡ãƒ¼ã‚¿ç«¶åˆãŒç™ºç”Ÿã™ã‚‹å±é™ºãªãƒ¡ã‚½ãƒƒãƒ‰
    public void unsafeIncrement() {
        // ã“ã®æ“ä½œã¯åŸå­çš„ã§ãªã„:
        // 1. counter ã®èª­ã¿å–ã‚Š
        // 2. å€¤ã®å¢—åŠ 
        // 3. counter ã¸ã®æ›¸ãè¾¼ã¿
        counter++; // è¤‡æ•°ã®ã‚¹ãƒ¬ãƒƒãƒ‰ã§åŒæ™‚å®Ÿè¡Œã™ã‚‹ã¨ç«¶åˆçŠ¶æ…‹
    }
    
    // åŒæœŸåŒ–ã«ã‚ˆã‚‹ç«¶åˆçŠ¶æ…‹ã®è§£æ±º
    public synchronized void safeIncrement() {
        counter++; // synchronized ã«ã‚ˆã‚ŠåŸå­æ€§ã‚’ä¿è¨¼
    }
    
    // Atomicã‚¯ãƒ©ã‚¹ã«ã‚ˆã‚‹è§£æ±º
    private AtomicInteger atomicCounter = new AtomicInteger(0);
    
    public void atomicIncrement() {
        atomicCounter.incrementAndGet(); // ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ãƒ¬ãƒ™ãƒ«ã§ã®åŸå­æ€§
    }
}
```

### C.7.2 ãƒ‡ãƒƒãƒ‰ãƒ­ãƒƒã‚¯ã®ç†è«–çš„åˆ†æ

#### ã‚³ãƒ•ãƒãƒ³ã®4æ¡ä»¶

ãƒ‡ãƒƒãƒ‰ãƒ­ãƒƒã‚¯ãŒç™ºç”Ÿã™ã‚‹ãŸã‚ã®å¿…è¦ååˆ†æ¡ä»¶ï¼š
1. **ç›¸äº’æ’é™¤ï¼ˆMutual Exclusionï¼‰**: ãƒªã‚½ãƒ¼ã‚¹ã¯åŒæ™‚ã«1ã¤ã®ãƒ—ãƒ­ã‚»ã‚¹ã®ã¿ãŒä½¿ç”¨
2. **ä¿æŒã¨å¾…æ©Ÿï¼ˆHold and Waitï¼‰**: ãƒ—ãƒ­ã‚»ã‚¹ã¯1ã¤ä»¥ä¸Šã®ãƒªã‚½ãƒ¼ã‚¹ã‚’ä¿æŒã—ãªãŒã‚‰ã»ã‹ã®ãƒªã‚½ãƒ¼ã‚¹ã‚’å¾…æ©Ÿ
3. **éãƒ—ãƒªã‚¨ãƒ³ãƒ—ã‚·ãƒ§ãƒ³ï¼ˆNo Preemptionï¼‰**: ãƒªã‚½ãƒ¼ã‚¹ã¯å¼·åˆ¶çš„ã«å¥ªå–ã§ããªã„
4. **å¾ªç’°å¾…æ©Ÿï¼ˆCircular Waitï¼‰**: ãƒ—ãƒ­ã‚»ã‚¹é–“ã§ãƒªã‚½ãƒ¼ã‚¹å¾…æ©Ÿã®å¾ªç’°ãŒå­˜åœ¨

<span class="listing-number">**ãƒªã‚¹ãƒˆAC-29**</span>

```java
public class DeadlockExample {
    private final Object lock1 = new Object();
    private final Object lock2 = new Object();
    
    // ãƒ‡ãƒƒãƒ‰ãƒ­ãƒƒã‚¯ãŒç™ºç”Ÿã™ã‚‹å¯èƒ½æ€§ã®ã‚ã‚‹ã‚³ãƒ¼ãƒ‰
    public void method1() {
        synchronized (lock1) {
            System.out.println("Thread " + Thread.currentThread().getId() + " acquired lock1");
            
            try { Thread.sleep(100); } catch (InterruptedException e) {}
            
            synchronized (lock2) { // å¾ªç’°å¾…æ©Ÿã®åŸå› 
                System.out.println("Thread " + Thread.currentThread().getId() + " acquired lock2");
            }
        }
    }
    
    public void method2() {
        synchronized (lock2) {
            System.out.println("Thread " + Thread.currentThread().getId() + " acquired lock2");
            
            try { Thread.sleep(100); } catch (InterruptedException e) {}
            
            synchronized (lock1) { // å¾ªç’°å¾…æ©Ÿã®åŸå› 
                System.out.println("Thread " + Thread.currentThread().getId() + " acquired lock1");
            }
        }
    }
    
    // ãƒ‡ãƒƒãƒ‰ãƒ­ãƒƒã‚¯å›é¿ç­–: ãƒ­ãƒƒã‚¯é †åºã®çµ±ä¸€
    public void safeMethod1() {
        synchronized (lock1) { // å¸¸ã« lock1 ã‚’å…ˆã«å–å¾—
            synchronized (lock2) {
                // å‡¦ç†
            }
        }
    }
    
    public void safeMethod2() {
        synchronized (lock1) { // å¸¸ã« lock1 ã‚’å…ˆã«å–å¾—
            synchronized (lock2) {
                // å‡¦ç†
            }
        }
    }
}
```

### C.7.3 ãƒ¡ãƒ¢ãƒªãƒ¢ãƒ‡ãƒ«ã¨é †åºä¿è¨¼

#### Java Memory Model (JMM)

<span class="listing-number">**ãƒªã‚¹ãƒˆAC-30**</span>

```java
public class MemoryModelExample {
    private boolean ready = false;
    private int value = 0;
    
    // Writer ã‚¹ãƒ¬ãƒƒãƒ‰
    public void writer() {
        value = 42;      // 1
        ready = true;    // 2
        // ãƒªã‚ªãƒ¼ãƒ€ãƒªãƒ³ã‚°ã«ã‚ˆã‚Š 2 ãŒ 1 ã‚ˆã‚Šå…ˆã«å®Ÿè¡Œã•ã‚Œã‚‹å¯èƒ½æ€§
    }
    
    // Reader ã‚¹ãƒ¬ãƒƒãƒ‰
    public void reader() {
        while (!ready) { // 3
            Thread.yield();
        }
        System.out.println(value); // 4: 0 ãŒå‡ºåŠ›ã•ã‚Œã‚‹å¯èƒ½æ€§
    }
    
    // volatile ã«ã‚ˆã‚‹é †åºä¿è¨¼
    private volatile boolean readyVolatile = false;
    private int valueVolatile = 0;
    
    public void writerVolatile() {
        valueVolatile = 42;      // 1
        readyVolatile = true;    // 2: volatile write
        // happens-before é–¢ä¿‚ã«ã‚ˆã‚Š 1 ã¯ 2 ã‚ˆã‚Šå…ˆã«å®Ÿè¡Œ
    }
    
    public void readerVolatile() {
        while (!readyVolatile) { // 3: volatile read
            Thread.yield();
        }
        System.out.println(valueVolatile); // 4: å¿…ãš 42 ãŒå‡ºåŠ›
        // happens-before é–¢ä¿‚ã«ã‚ˆã‚Š 2 ã¯ 3 ã‚ˆã‚Šå…ˆã€3 ã¯ 4 ã‚ˆã‚Šå…ˆ
    }
}
```



## ã¾ã¨ã‚ï¼šç†è«–ã¨å®Ÿè·µã®çµ±åˆ

ã“ã®ä»˜éŒ²ã§æ‰±ã£ãŸç†è«–çš„åŸºç›¤ã¯ã€å˜ãªã‚‹å­¦è¡“çš„èˆˆå‘³ã«ã¨ã©ã¾ã‚‰ãšã€å®Ÿéš›ã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢é–‹ç™ºã«ãŠã„ã¦ä»¥ä¸‹ã®ã‚ˆã†ãªå®Ÿè·µçš„ä¾¡å€¤ã‚’æä¾›ã—ã¾ã™ï¼š

### ç†è«–ã®å®Ÿè·µçš„å¿œç”¨

1. **è¨­è¨ˆåˆ¤æ–­ã®æ ¹æ‹ **: ãªãœç‰¹å®šã®è¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³ã‚„åŸå‰‡ãŒæ¨å¥¨ã•ã‚Œã‚‹ã®ã‹
2. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹äºˆæ¸¬**: ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®è¨ˆç®—è¤‡é›‘åº¦ã«ã‚ˆã‚‹æ€§èƒ½è¦‹ç©ã‚‚ã‚Š
3. **ãƒã‚°ã®äºˆé˜²**: å½¢å¼çš„ä»•æ§˜ã«ã‚ˆã‚‹è«–ç†çš„æ­£ç¢ºæ€§ã®æ¤œè¨¼
4. **ä¸¦è¡Œæ€§ã®åˆ¶å¾¡**: ç«¶åˆçŠ¶æ…‹ã‚„ãƒ‡ãƒƒãƒ‰ãƒ­ãƒƒã‚¯ã®ç†è«–çš„ç†è§£ã«ã‚‚ã¨ã¥ãå®‰å…¨ãªå®Ÿè£…

### ç¶™ç¶šå­¦ç¿’ã¸ã®åŸºç›¤

ã“ã‚Œã‚‰ã®ç†è«–çš„çŸ¥è­˜ã¯ã€æ–°ã—ã„æŠ€è¡“ã‚„ãƒ‘ãƒ©ãƒ€ã‚¤ãƒ ã‚’å­¦ã¶éš›ã®åŸºç¤ã¨ãªã‚Šã¾ã™ï¼š

- **é–¢æ•°å‹ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°**: ãƒ©ãƒ ãƒ€è¨ˆç®—ã‚„åœè«–ã®ç†è§£
- **åˆ†æ•£ã‚·ã‚¹ãƒ†ãƒ **: CAPå®šç†ã‚„åˆ†æ•£ã‚³ãƒ³ã‚»ãƒ³ã‚µã‚¹ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 
- **æ©Ÿæ¢°å­¦ç¿’**: æœ€é©åŒ–ç†è«–ã‚„çµ±è¨ˆå­¦ç¿’ç†è«–
- **é‡å­ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°**: é‡å­åŠ›å­¦ã¨è¨ˆç®—ç†è«–ã®èåˆ

ç†è«–ã¨å®Ÿè·µã®ãƒãƒ©ãƒ³ã‚¹ã‚’ä¿ã¡ãªãŒã‚‰ã€ã“ã®çŸ¥è­˜ã‚’å®Ÿéš›ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§æ´»ç”¨ã—ã¦ãã ã•ã„ã€‚

## å‚è€ƒæ–‡çŒ®

- "Introduction to Algorithms" by Cormen, Leiserson, Rivest, and Stein
- "The Art of Computer Programming" by Donald E. Knuth
- "Software Engineering: A Practitioner's Approach" by Roger Pressman
- "Concurrent Programming in Java" by Doug Lea
- "Formal Methods: State of the Art and New Directions" by Jeannette Wing