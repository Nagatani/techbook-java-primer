# 付録B.09: Java Memory ModelとHappens-Before関係

## 概要

Javaの並行プログラミングにおける最も重要かつ難解な概念の1つである、Java Memory Model（JMM）とHappens-Before関係について学べます。これらの概念を理解することで、マルチスレッドプログラムの正確性を保証し、微妙な並行性バグを回避できます。

## GitHub実装プロジェクト

本付録の詳細な解説、実装例、並行性バグの実証は以下のGitHubプロジェクトで公開されています：

📁 **`/appendix/java-memory-model/`**

### 提供内容

- **並行性バグの実証**: 可視性問題、競合状態の再現可能な例
- **Happens-Before規則**: 各規則の実装と動作確認
- **メモリバリアの実装**: volatile、synchronized、finalの効果実証
- **ロックフリーアルゴリズム**: CAS操作を使った並行データ構造
- **False Sharing対策**: キャッシュライン最適化の実装例

### 主要な技術的知見

- **並行性バグコスト**: デバッグ時間通常の**10-50倍**
- **可視性問題**: 金融システムで残高計算誤差による重大インシデント
- **適切な同期**: Knight Capitalような**4億4000万ドル損失**の回避

### 実装内容

- **可視性問題デモ**: stopRequestedパターンの危険性実証
- **Double-Checked Locking**: 正しい実装と間違った実装の比較
- **Happens-Before規則**: プログラム順序、volatile、モニターロック規則
- **ロックフリー構造**: スタック、キュー、カウンタの実装
- **パフォーマンス測定**: 同期化オーバーヘッドの定量評価

### ビジネスへの実際の影響

- **金融取引システム**: データ競合により残高計算誤差発生
- **在庫管理システム**: 可視性問題で在庫数更新不整合
- **リアルタイムゲーム**: メモリオーダリング問題でゲーム状態不整合

詳細な理論解説、バグ実証例、安全な並行プログラミング手法については、上記GitHubディレクトリを参照してください。

## 実践的なサンプルコード

本付録で解説したJava Memory ModelとHappens-Before関係の実践的なサンプルコードは、`/appendix/java-memory-model/`ディレクトリに収録されています。並行性バグの実証、安全な同期化技法、ロックフリーアルゴリズムなど、並行プログラミングの理解を深める具体的なコード例を参照できます。