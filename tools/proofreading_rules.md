# 大規模ファイル校正作業の効率化ルール

## 1. ファイル分割の基本方針

### 1.1 分割基準
- **基本チャンクサイズ**: 250行（約10KB相当）
- **最大チャンクサイズ**: 300行（コンテキスト制限を考慮）
- **分割ポイント**: 以下の優先順位で自然な区切りを選択
  1. 見出し（#で始まる行）
  2. 空行
  3. 段落の終わり（。で終わる行）
  4. コードブロックの境界

### 1.2 分割が必要なファイルの判定
- 500行以上のファイルは必ず分割
- 20KB以上のファイルは必ず分割
- 複数章にまたがる内容は章ごとに分割

## 2. 校正作業フロー

### 2.1 事前準備
```bash
# 1. 対象ファイルのサイズ確認
wc -l manuscripts/target_file.md

# 2. 500行以上の場合、分割ツールを使用
python3 tools/manuscript_proofreader.py split manuscripts/target_file.md

# 3. 分割結果の確認
ls -la proofreading_chunks/
```

### 2.2 校正実施手順
1. **メタデータファイルの確認**
   - `target_file_metadata.json`を読み、チャンク数と各チャンクの概要を把握
   
2. **チャンクごとの校正**
   - 各チャンクを個別に読み込んで校正
   - チャンク間の文脈の連続性に注意
   - 校正済みチャンクは一時保存

3. **校正記録の管理**
   ```json
   {
     "chunk_id": 1,
     "status": "completed",
     "changes": [
       {
         "line": 45,
         "old": "することができます",
         "new": "できます",
         "reason": "冗長表現の簡潔化"
       }
     ]
   }
   ```

### 2.3 マージと検証
```bash
# 1. 校正済みチャンクのマージ
python3 tools/manuscript_proofreader.py merge proofreading_chunks/target_file

# 2. textlintによる検証
npm run lint manuscripts/target_file.md

# 3. 差分確認
git diff manuscripts/target_file.md
```

## 3. 校正ルール

### 3.1 日本語表現の改善

#### 安全な変換（文脈に依存しない）
1. **冗長表現の簡潔化**
   - ❌ 「することができます」→ ✅ 「できます」
   - ❌ 「することが可能です」→ ✅ 「可能です」
   - ❌ 「されることになります」→ ✅ 「されます」

#### 手動確認が必須の変換（文脈依存）
2. **注意が必要な言い回しの変更**
   - 「より」→ 比較の場合はそのまま、手段・原因の場合は「により」を維持
   - 「から」→ 起点・理由の両方の意味があるため文脈を確認
   - 「ため」→ 目的・原因の両方の意味があるため文脈を確認
   - 「において」「における」→ 技術文書では適切な場合が多い
   - 「および」「または」→ 技術文書では明確性のため適切な場合が多い

3. **文体の統一**
   - 本文：ですます調で統一
   - リスト項目：である調で統一
   - 脚注：ですます調で統一

### 3.2 技術文書特有の注意点
1. **専門用語の保持**
   - プログラミング用語はそのまま維持
   - カタカナ表記の統一（例：インターフェイス）

2. **コードブロックの扱い**
   - コード内のコメントは校正対象
   - コード自体は変更しない
   - コードリスト番号は「サンプルコードX-Y」形式

3. **図表参照の一貫性**
   - 「図X-Y」「表X-Y」の形式を維持
   - 参照文言の統一

## 4. 効率化のためのベストプラクティス

### 4.1 バッチ処理の活用
```python
# 複数ファイルの一括分割
for file in manuscripts/*.md:
    if line_count > 500:
        split_file(file)
```

### 4.2 進捗管理
- TodoWriteツールで各チャンクの校正状況を管理
- 完了したチャンクは即座にステータス更新

### 4.3 品質保証
1. **段階的な校正**
   - 第1段階：明らかな誤字・冗長表現の修正
   - 第2段階：文体・表現の自然さの改善
   - 第3段階：全体の一貫性確認

2. **クロスチェック**
   - チャンク境界での文脈の連続性
   - 用語の統一性
   - 参照の整合性

## 5. トラブルシューティング

### 5.1 よくある問題と対処法
1. **チャンク境界での文の分断**
   - 前後のチャンクを参照して文脈を確認
   - 必要に応じて分割ポイントを調整

2. **大きすぎるチャンク**
   - 手動で適切な分割ポイントを指定
   - コードブロックが大きい場合は前後で分割

3. **マージエラー**
   - メタデータの整合性を確認
   - チャンクの順序と完全性をチェック

### 5.2 パフォーマンス最適化
- 10チャンク以上の場合は、5チャンクずつ処理
- メモリ使用量に注意（特に大きなファイルのマージ時）

## 6. 継続的改善

### 6.1 フィードバックループ
1. 校正結果のレビュー
2. よくある修正パターンの記録
3. ルールの更新と改善

### 6.2 自動化の推進
- 頻出する修正パターンの自動化スクリプト作成
- textlintルールの追加・調整
- 校正支援ツールの機能拡張

---

このルールは定期的に見直し、プロジェクトの要求に応じて更新します。